import pandas as pd
import re

input_file = "ascii_table.txt"
output_file = "vulnerability_report.xlsx"

def is_data_line(line):
    line = line.strip()
    return '|' in line and not re.fullmatch(r'[\s\|\-\+]+', line)

def extract_table_lines(filename):
    with open(filename, 'r', encoding='utf-8') as f:
        lines = f.readlines()
    return [line for line in lines if is_data_line(line)]

def parse_ascii_table(lines):
    headers = []
    data_rows = []
    current_row = []

    for line in lines:
        # Split line by pipe, strip whitespace, and remove empty
        columns = [col.strip() for col in line.strip().split('|')]
        columns = [col for col in columns if col]

        if not headers:
            headers = columns
            continue

        # If a continuation (first few columns empty), merge into previous
        if len(columns) < len(headers):
            for i in range(len(columns)):
                if columns[i]:
                    current_row[i + (len(headers) - len(columns))] += ", " + columns[i]
        else:
            if current_row:
                data_rows.append(current_row)
            current_row = columns

    if current_row:
        data_rows.append(current_row)

    return headers, data_rows

# Read + Parse
lines = extract_table_lines(input_file)
headers, rows = parse_ascii_table(lines)

# Convert to Excel
df = pd.DataFrame(rows, columns=headers)
df.to_excel(output_file, index=False)

print(f"âœ… Excel generated: {output_file}")
